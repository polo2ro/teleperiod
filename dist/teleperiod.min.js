function Selection(e){"use strict";this.teleperiod=e,this.dtstart=null,this.dtend=null;var s=this;this.overlayItems=[],this.isValid=function(){return null!==s.dtend&&null!==s.dtstart&&s.dtstart.getTime()<s.dtend.getTime()},this.setDate=function(t){return t.setMilliseconds(0),null===s.dtstart||s.dtstart.getTime()>t.getTime()||s.isValid()?(s.dtstart=t,s.dtend=null,s.resetOverlay(),!1):s.dtstart.getTime()<t.getTime()?(s.dtend=t,s.isValid()&&s.highlightPeriods(),s.notifyUpdated(),!0):(s.resetOverlay(),!1)},this.notifyUpdated=function(){s.teleperiod.settings.onUpdated&&s.teleperiod.settings.onUpdated(s)},this.getDayGroups=function(){for(var t,e=new Date(s.dtstart),n=[];e<s.dtend;)t=s.teleperiod.getDayGroupByDate(e),n.push(t),e.setDate(e.getDate()+1);return n},this.cropPeriod=function(t){if(t.dtstart>=s.dtstart&&t.dtend<=s.dtend)return t;if(t.dtstart>=s.dtend||t.dtend<=s.dtstart)return null;var e={};return e.dtstart=t.dtstart>=s.dtstart?t.dtstart:s.dtstart,e.dtend=t.dtend<=s.dtend?t.dtend:s.dtend,e},this.isLastMinute=function(t){return 60*t.getHours()+t.getMinutes()===e.getDayLastMinute()},this.isFirstMinute=function(t){return 60*t.getHours()+t.getMinutes()===e.getDayFirstMinute()},this.testContiguous=function(t,e){return s.isLastMinute(t.dtend)&&s.isFirstMinute(e.dtstart)},this.getValidPeriods=function(t){void 0===t&&(t=!0);var e,n=new Date(s.dtstart);n.setHours(0,0,0);for(var i,a=[];n<s.dtend;){if(void 0!==s.teleperiod.workingtimesEvents[n])for(var r=s.teleperiod.workingtimesEvents[n],o=0;o<r.length;o++)(e=s.cropPeriod(r[o]))&&(void 0!==(i=a[a.length-1])&&t&&s.testContiguous(i,e)?i.dtend=e.dtend:a.push(e));n.setDate(n.getDate()+1)}return a},this.highlightPeriods=function(){for(var t=s.getValidPeriods(!1),e=0;e<t.length;e++){var n=s.teleperiod.getDayGroupByDate(t[e].dtstart);s.addOverlay(n,t[e])}},this.addOverlay=function(t,e){var n=s.teleperiod.getDateY(e.dtstart),i=s.teleperiod.getDateY(e.dtend),a=t.append("rect");return a.attr("class","selection").attr("y",n).attr("height",i-n).attr("width",s.teleperiod.getDateWidth()-1).on("mouseover",function(){s.setOverlayClassed("mouseover",!0)}).on("mouseout",function(){s.setOverlayClassed("mouseover",!1)}).on("click",function(){s.dtstart=null,s.dtend=null,s.resetOverlay()}),s.overlayItems.push(a),a},this.removeOverlay=function(){for(var t=0;t<s.overlayItems.length;t++)s.overlayItems[t].remove();s.overlayItems=[]},this.setOverlayClassed=function(t,e){for(var n=0;n<s.overlayItems.length;n++)s.overlayItems[n].classed(t,e)},this.resetOverlay=function(){s.removeOverlay(),s.notifyUpdated()},this.getDuration=function(){for(var t=s.getValidPeriods(!1),e=0,n=0;n<t.length;n++)if(t[n].dtstart&&t[n].dtend){var i=t[n].dtstart.getTime(),a=t[n].dtend.getTime();i<a&&(e+=a-i)}return e}}function Teleperiod(t){"use strict";var p=this;this.viewport=t.object,this.settings=t,this.main=null,this.wtTooltip=null,this.workingtimesEvents={},this.events={},this.timelines=[],this.loadedIntervals=[],this.dayGroupByDate={},this.queued=[],this.selection=new Selection(this),this.lastMouseDown=null,this.viewportFrom=null,this.viewportTo=null,this.floatFrom=null,this.floatTo=null,this.leftButtonGroup=null,this.rightButtonGroup=null,this.timeLineNamesGroup=null,this.getWidth=function(){return this.settings.width||p.viewport.node().parentNode.offsetWidth},this.getDateWidth=function(){return this.settings.dateWidth||30},this.getDateHeight=function(){return 250},this.getHeight=function(){return p.getHeaderHeight()+p.getGraphHeight()+p.getTimelinesHeight()},this.getTimelinesHeight=function(){return p.timelines.length*(p.getTimelineHeight()+p.getTimelineMarginTop())},this.getHeaderHeight=function(){return 50},this.getGraphHeight=function(){return 300},this.getTimelineHeight=function(){return 20},this.getTimelineMarginTop=function(){return this.settings.timelineMarginTop||10},this.getButtonWidth=function(){return this.settings.buttonWidth||30},this.getDayOff=function(){return this.settings.dayOff||[6,0]},this.getMoveDays=function(){return 7},this.getDayFirstMinute=function(){return this.settings.dayFirstMinute||420},this.getDayLastMinute=function(){return this.settings.dayLastMinute||1200},this.getSnapDistance=function(){return this.settings.snapDistance||10},this.getDateLocale=function(){return this.settings.dateLocale},this.getFocusDate=function(){return this.settings.focusDate||new Date},this.moveTo=function(t){this.settings.focusDate=t,this.createSlidingItems()},this.initFloatDates=function(){var t=new Date(p.getFocusDate());t.setHours(0,0,0),p.floatFrom=new TimespanBoundary(t),p.floatTo=new TimespanBoundary(t),p.floatFrom.onUpdate(this.drawIntervalDates),p.floatTo.onUpdate(this.drawIntervalDates);var e=1+Math.round(p.getWidth()/p.getDateWidth());p.viewportFrom=0,p.viewportTo=e,p.main.attr("width",e*p.getDateWidth()),p.floatTo.add(e)},this.setSize=function(){p.viewport.attr("width",p.getWidth()).attr("height",p.getHeight())},this.createSlidingItems=function(){null!==p.main&&p.main.remove(),p.main=p.viewport.append("svg"),p.main.attr("class","main").attr("x",0).attr("width",0).attr("height",p.getHeaderHeight()+p.getGraphHeight()+p.getTimelinesHeight()),p.initFloatDates(),p.leftButton(),p.rightButton(),p.timeLineNames(),p.createTooltip()},this.createMain=function(){this.createSlidingItems(),this.setupDragBeavior()},this.createTooltip=function(){null!==this.wtTooltip&&this.wtTooltip.remove(),p.wtTooltip=p.viewport.append("svg").attr("width",p.getDateWidth()+100).attr("height",50).style("opacity",0),p.wtTooltip.append("polygon").attr("class","wtTooltip").attr("transform","translate("+p.getDateWidth()+",0)").attr("points","15,0 100,0 100,50 15,50 15,25 0,2 15,8"),p.wtTooltip.append("line").attr("x1",0).attr("y1",3).attr("x2",p.getDateWidth()-1).attr("y2",3).attr("stroke","red").attr("stroke-width","2").attr("pointer-events","none");var t=p.getDateWidth()+23;p.wtTooltip.append("text").attr("y",20).attr("x",t).attr("class","wtTooltipDate"),p.wtTooltip.append("text").attr("y",40).attr("x",t).attr("class","wtTooltipHour")},this.timeLineNames=function(){null!==this.timeLineNamesGroup&&this.timeLineNamesGroup.remove(),this.timeLineNamesGroup=p.viewport.append("svg");for(var t=0;t<p.timelines.length;t++)this.timeLineNamesGroup.append("text").attr("class","timeline-name").attr("x",20).attr("y",p.getGraphHeight()+5+p.getTimelineHeight()+t*(p.getTimelineMarginTop()+p.getTimelineHeight())).text(p.timelines[t].name)},this.setupDragBeavior=function(){var e=null;p.main.on("mousedown",function(t){e=new MouseDrag(p)}),p.main.call(d3.behavior.drag().on("drag",function(){e&&e.dragmove()}))},this.draw=function(){p.viewport.classed("teleperiod",!0),p.setSize(),p.createMain()},this.leftButton=function(){null!==this.leftButtonGroup&&this.leftButtonGroup.remove(),this.leftButtonGroup=p.viewport.append("svg").attr("width",p.getButtonWidth()).attr("height",p.getHeaderHeight()).attr("class","button").on("mousedown",function(){d3.event.preventDefault()}).on("click",function(){p.queue(p.backward)}),this.leftButtonGroup.append("rect").attr("class","buttonbg").attr("width",p.getButtonWidth()).attr("height",p.getHeaderHeight()),this.leftButtonGroup.append("polygon").attr("class","buttonarrow").attr("points","25,5 25,45 5,25")},this.rightButton=function(){null!==this.rightButtonGroup&&this.rightButtonGroup.remove(),this.rightButtonGroup=p.viewport.append("svg").attr("width",p.getButtonWidth()).attr("height",p.getHeaderHeight()).attr("class","button").attr("x",p.getWidth()-p.getButtonWidth()).on("mousedown",function(){d3.event.preventDefault()}).on("click",function(){p.queue(p.forward)}),this.rightButtonGroup.append("rect").attr("class","buttonbg").attr("width",p.getButtonWidth()).attr("height",p.getHeaderHeight()),this.rightButtonGroup.append("polygon").attr("class","buttonarrow").attr("points","5,5 25,25 5,45")},this.drawIntervalDates=function(t,e){for(var n=new Date(t);n<e;){var i=new Date(n),a=p.drawDate(n);n.setDate(n.getDate()+1),i.setHours(0,0,0),p.dayGroupByDate[i]=a}p.load(t,e)},this.getDateX=function(t){var e=t.getTime()/1e3,n=p.floatFrom.currentDate.getTime()/1e3;return(Math.ceil(e/86400)-Math.ceil(n/86400))*p.getDateWidth()},this.getDateY=function(t){var e=60*t.getHours()+t.getMinutes();if(e<p.getDayFirstMinute())return 0;if(e>p.getDayLastMinute())return p.getDayLastMinute();var n=e-p.getDayFirstMinute(),i=p.getDayLastMinute()-p.getDayFirstMinute();return Math.round(n*p.getDateHeight()/i)},this.getDateFromX=function(t){var e=Math.ceil(t/p.getDateWidth()),n=new Date(p.floatFrom.currentDate);return n.setDate(n.getDate()+e),n.setHours(0,0,0),n},this.getMinutesFromY=function(t){var e=p.getDayLastMinute()-p.getDayFirstMinute(),n=p.getDateHeight()/e;return p.getDayFirstMinute()+Math.round(t/n)},this.drawDate=function(t){var e=p.getDateX(t),n=p.main.append("g").attr("class","day").attr("transform","translate("+e+","+p.getHeaderHeight()+")");n.append("rect").attr("width",p.getDateWidth()-1).attr("height",p.getDateHeight()),-1!==p.getDayOff().indexOf(t.getDay())&&n.attr("class","day dayoff"),n.append("text").attr("class","weekday").attr("x",5).attr("y",-10).attr("transform","rotate(90)").text(t.toLocaleDateString(p.getDateLocale(),{weekday:"long"})),n.append("text").attr("class","date").attr("x",p.getDateWidth()/2).attr("y",-10).text(t.getDate()),1===t.getDate()&&n.append("text").attr("class","month").attr("x",5).attr("y",-35).text(t.toLocaleDateString(p.getDateLocale(),{month:"long",year:"numeric"}));for(var i=0;i<p.timelines.length;i++)p.timelines[i].drawDate(n,t,i);return n},this.addTimeLine=function(t){(t.teleperiod=p).timelines.push(t)},this.load=function(t,e){var n={from:t,to:e};p.loadedIntervals.push(n),p.loadWorkingTimes(n),p.loadEvents(n);for(var i=0;i<p.timelines.length;i++)p.timelines[i].load(t,e)},this.getWorkingTimesFromEvent=function(t){var e=t.dtstart.getFullYear()===t.dtend.getFullYear(),n=t.dtstart.getMonth()===t.dtend.getMonth(),i=t.dtstart.getDate()===t.dtend.getDate();if(e&&n&&i)return[t];var a=new Date(t.dtstart);a.setHours(0,0,0,0);for(var r,o=[];a<t.dtend&&(a<t.dtstart?r={dtstart:t.dtstart}:(r={dtstart:new Date(a)}).dtstart.setHours(0,p.getDayFirstMinute(),0),a.setDate(a.getDate()+1),!(r.dtstart>=t.dtend));)a>t.dtend?r.dtend=t.dtend:(r.dtend=new Date(t.dtstart),r.dtend.setHours(0,p.getDayLastMinute(),59),r.dtend<r.dtstart&&(r.dtend=new Date(r.dtstart.getFullYear(),r.dtstart.getMonth(),r.dtstart.getDate(),r.dtend.getHours(),r.dtend.getMinutes(),r.dtend.getSeconds()))),o.push(r);return o},this.loadWorkingTimes=function(t){var e,n=[];function i(t){(e=new Date(t.dtstart)).setHours(0,0,0),void 0===p.workingtimesEvents[e]&&(p.workingtimesEvents[e]=[]),p.workingtimesEvents[e].push(t),n.push(t)}function a(t){p.getWorkingTimesFromEvent(t).forEach(i)}p.settings.workingtimes(t).then(function(t){t.forEach(a),p.addWorkingtimes(n)},p.onError)},this.loadEvents=function(a){for(var r,o=p.settings.selectedEvents,t=new Date(a.from);t<a.to;)p.getDayGroupByDate(t).selectAll(".event-item").remove(),t.setDate(t.getDate()+1);p.settings.events(a).then(function(t){for(var e=[],n={dtstart:null,dtend:null},i=0;i<t.length;i++)t[i].dtstart>a.to||t[i].dtend<a.from||(void 0===o||void 0===t[i].uid||-1===o.indexOf(t[i].uid)?((r=new Date(t[i].dtstart)).setHours(0,0,0,0),void 0===p.events[r]&&(p.events[r]=[]),p.events[r].push(t[i]),e.push(t[i])):((null===n.dtstart||n.dtstart>t[i].dtstart)&&(n.dtstart=t[i].dtstart),(null===n.dtend||n.dtend<t[i].dtend)&&(n.dtend=t[i].dtend)));null!==n.dtstart&&null!==n.dtend&&p.setSelection(n.dtstart,n.dtend),p.addRegularEvents(e)},p.onError)},this.getDayGroupByDate=function(t){var e=new Date(t);return e.setHours(0,0,0),void 0===p.dayGroupByDate[e]?null:p.dayGroupByDate[e]},this.addWorkingtimes=function(t){p.addEvents(t,"workingtime",{mouseover:function(){p.wtTooltip.transition().duration(200).style("opacity",1)},mouseout:function(){p.wtTooltip.transition().duration(500).style("opacity",0)},mousemove:p.updateWtTooltip,click:function(){p.selection.setDate(p.getPointerDate(this))}})},this.addRegularEvents=function(t){p.addEvents(t,"event",{})},this.getDayBegin=function(t){var e=new Date(t);return e.setHours(0,p.getDayFirstMinute(),0),e},this.getDayEnd=function(t){var e=new Date(t),n=p.getDayLastMinute();return e.setHours(0,n,0),e},this.addEvents=function(t,e,n){for(var i=0;i<t.length;i++)p.drawEvent(t[i],e,n)},this.refreshEvents=function(){if(null!==p.floatFrom&&null!==p.floatTo){var t={from:p.floatFrom.currentDate,to:p.floatTo.currentDate};p.main.selectAll(".event-item").remove(),p.loadEvents(t)}},this.editEvents=function(t){p.settings.selectedEvents=t,p.refreshEvents()};var e,f=(e=1,function(){return"clip"+e++});this.getDayGroupEvents=function(t,e){var n=[];return t.selectAll("."+e).each(function(){n.push(this._teleperiodEvent)}),n},this.getOverlappedEvents=function(t,e){var n=[];return p.getDayGroupEvents(t,"event").forEach(function(t){t.dtend<e.dtstart||t.dtstart>e.dtend||n.push(t)}),n},this.isEventIn=function(t,e){if(void 0===t.uid)return!1;for(var n=0;n<e.length;n++){var i=void 0!==e[n].uid&&e[n].uid===t.uid,a=e[n].dtstart.getTime()===t.dtstart.getTime(),r=e[n].dtend.getTime()===t.dtend.getTime();if(i&&a&&r)return!0}return!1},this.drawEvent=function(t,e,n){var i,a,r,o,s;for(r=new Date(t.dtstart);r.getTime()<t.dtend.getTime();)if(r<p.floatFrom.currentDate||r>p.floatTo.currentDate)r.setDate(r.getDate()+1);else{p.getDateX(r),o=p.getDayBegin(r),s=p.getDayEnd(r),i=t.dtstart>o?p.getDateY(t.dtstart):p.getDateY(o),a=t.dtend<s?p.getDateY(t.dtend):p.getDateY(s);var d=p.getDayGroupByDate(r);if("event"===e){var u=p.getOverlappedEvents(d,t);if(0<u.length){void 0!==console&&(p.isEventIn(t,u)||console.warn("Event ignored because of a conflict",t,"others in same day",u)),r.setDate(r.getDate()+1);continue}}var l=f();d.append("clipPath").attr("id",l).attr("class",e+"-item").append("rect").attr("class",e+"-item").attr("y",i).attr("width",p.getDateWidth()-1).attr("height",a-i-6).attr("y",i+5).attr("x",-10).attr("transform","rotate(-90)");var h=e,g=e+"-summary";if(t.categories){var c=t.categories;c instanceof Array||(c=c.split(",")),h+=" "+c.map(function(t){return"category-"+t}).join(" "),g+=" "+c.map(function(t){return"summary-category-"+t}).join(" ")}(d.append("rect").attr("class",h+" "+e+"-item").attr("y",i).attr("height",a-i).attr("width",p.getDateWidth()-1).on("mouseover",n.mouseover).on("mouseout",n.mouseout).on("mousemove",n.mousemove).on("click",n.click)[0][0]._teleperiodEvent=t).summary&&d.append("text").attr("class",e+"-item "+g).attr("x",i+5).attr("y",-10).attr("transform","rotate(90)").attr("clip-path","url(#"+l+")").text(t.summary),r.setDate(r.getDate()+1)}},this.getPointerDate=function(t){var e=d3.mouse(t)[1],n=d3.select(t.parentNode),i=parseInt(n.attr("transform").match(/translate\((\d+),\d+\)/)[1],10),a=p.getDateFromX(i),r=d3.select(t),o=parseInt(r.attr("y"),10),s=o+parseInt(r.attr("height"),10),d=p.getSnapDistance();e-o<d&&(e=o),s-e<d&&(e=s);var u=p.getMinutesFromY(e),l=Math.floor(u/60),h=u%60;return h=10*Math.round(h/10),a.setHours(l,h,0),a},this.updateWtTooltip=function(){var t=p.getPointerDate(this),e=d3.mouse(this),n=e[0],i=e[1],a=d3.select(this.parentNode);n=parseInt(a.attr("transform").match(/translate\((\d+),\d+\)/)[1],10),n+=parseInt(p.main.attr("x"),10),i=p.getDateY(t),p.wtTooltip.attr("x",n),p.wtTooltip.attr("y",p.getHeaderHeight()+i-4),p.wtTooltip.select("text.wtTooltipDate").text(t.toLocaleDateString(p.getDateLocale())),p.wtTooltip.select("text.wtTooltipHour").text(t.toLocaleTimeString(p.getDateLocale(),{hour:"2-digit",minute:"2-digit"}))},this.slideMain=function(t){return p.main.transition().attr("x",function(){return parseInt(this.getAttribute("x"),10)+t*p.getDateWidth()})},this.queue=function(t){p.queued.push(t),1<p.queued.length||p.processQueued()},this.processQueued=function(){var t=(0,p.queued[0])(),e=0;t.each("start",function(){e++}).each("end",function(){if(0==--e){if(p.queued.shift(),p.queued.length<=0)return!1;p.processQueued()}})},this.createSpaceOnLeft=function(e){var t=parseInt(p.main.attr("width"),10);return p.main.attr("width",t+e*p.getDateWidth()),p.main.attr("x",function(){return parseInt(this.getAttribute("x"),10)-e*p.getDateWidth()}),p.main.selectAll(".day").attr("transform",function(){var t=this.getAttribute("transform").match(/\((\d+),(\d+)\)/);return t?"translate("+(parseInt(t[1],10)+e*p.getDateWidth())+","+t[2]+")":null})},this.backwardGrow=function(){if(p.viewportFrom-=p.getMoveDays(),p.viewportTo-=p.getMoveDays(),p.viewportFrom<p.floatFrom.dayPosition){var t=p.viewportFrom-p.floatFrom.dayPosition;p.createSpaceOnLeft(-1*t);return p.floatFrom.add(t),!0}return!1},this.forwardGrow=function(){if(p.viewportFrom+=p.getMoveDays(),p.viewportTo+=p.getMoveDays(),p.viewportTo>p.floatTo.dayPosition){var t=p.viewportTo-p.floatTo.dayPosition,e=Math.abs(parseInt(p.main.attr("x"),10))+p.getWidth(),n=Math.abs(t*p.getDateWidth());return p.main.attr("width",e+n),p.floatTo.add(t),!0}return!1},this.backward=function(){return p.backwardGrow(),p.slideMain(p.getMoveDays())},this.forward=function(){return p.forwardGrow(),p.slideMain(-1*p.getMoveDays())},this.setSelection=function(t,e){p.selection.resetOverlay(),p.selection.setDate(t),p.selection.setDate(e),p.selection.isValid()&&p.selection.highlightPeriods()},this.onError=function(t){void 0!==console&&console.log(t)}}function Timeline(t,e){"use strict";this.name=t,this.datasource=e,this.loadedEvents=[],this.dayIndex={},this.teleperiod=null,this.color={};var u=this;this.load=function(a,r){var o,s,d,t={from:a,to:r};u.datasource(t).then(function(t){for(var e=0;e<t.length;e++)for(o=t[e],u.loadedEvents.push(o),i=void 0,(n=o).dtstart<a&&(i=new Date(a)),(i=new Date(n.dtstart)).setHours(0,0,0),d=i;d.getTime()<o.dtend.getTime()&&d.getTime()<r;)s=u.teleperiod.getDayBegin(d),void 0!==u.dayIndex[s]&&u.addEventOnDay(u.dayIndex[s],o),d.setDate(d.getDate()+1);var n,i},this.teleperiod.onError)},this.drawDate=function(t,e,n){var i=u.teleperiod,a=i.getDateHeight()+i.getTimelineMarginTop(),r=n*(i.getTimelineHeight()+i.getTimelineMarginTop()),o=t.append("rect").attr("class","timelineday").attr("y",a+r).attr("width",i.getDateWidth()).attr("height",i.getTimelineHeight()).attr("style","fill:"+u.getBackgroundColor()+";");u.dayIndex[u.teleperiod.getDayBegin(e)]=o},this.addEventOnDay=function(t,e){var n,i="";(n=t.select("title")).node()?i=n.text():n=t.append("title"),t.node().__events||(t.node().__events=[]);var a=t.node().__events;a.push(e),0<i.length?i+=", "+e.summary:i=e.summary,n.text(i),t.attr("style","fill:"+u.getColor(a.length)+";")},this.setColor=function(t,e){u.color[t]=e},this.getBackgroundColor=function(){return u.color[0]?u.color[0]:"rgba(32, 47, 72, 0.78)"},this.getColor=function(t){if(u.color[t])return u.color[t];var e=[];for(var n in u.color)if(u.color.hasOwnProperty(n)){if(t<n)continue;e.push(n)}return 0===e.length?"rgba(10, 180, 10, 1)":(e.sort(),e.pop())}}function TimespanBoundary(t){"use strict";this.initDate=t,this.currentDate=t,this.dayPosition=0,this.onUpdateCallback=null;var a=this;this.add=function(t){a.dayPosition+=t;var e=new Date(a.currentDate),n=new Date(a.currentDate);if(n.setDate(a.currentDate.getDate()+t),a.currentDate=n,null!==a.onUpdateCallback){var i=new Date(n);i.getTime()>e.getTime()?a.onUpdateCallback(e,i):a.onUpdateCallback(i,e)}},this.onUpdate=function(t){a.onUpdateCallback=t}}function MouseDrag(n){"use strict";var t=d3.mouse(n.viewport.node())[0],e=parseInt(n.main.attr("x"),10),i=(parseInt(n.main.attr("width"),10),parseInt(n.viewport.attr("width"),10)),a=n.viewport.attr("x");a=null===a?0:parseInt(a,10);var r,o,s,d=n.getMoveDays()*n.getDateWidth(),u=this;this.getLeftDistance=function(){return a-o},this.getRightDistance=function(){var t=a+i,e=parseInt(n.main.attr("width"),10);return o+e-t},this.dragmove=function(){r=d3.mouse(n.viewport.node())[0],o=e+(s=r-t),u.getLeftDistance()<0&&n.backwardGrow()&&(e-=d),u.getRightDistance()<0&&n.forwardGrow()&&d,n.main.attr("x",e+s)}}