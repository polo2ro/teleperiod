<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Teleperiod sample</title>
        <link rel="stylesheet" type="text/css" href="bower_components/bootstrap-css-only/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="bower_components/bootstrap-css-only/css/bootstrap-theme.min.css">
        <link rel="stylesheet" type="text/css" href="styles/teleperiod.css">

        <script type="text/javascript" src="bower_components/d3/d3.min.js"></script>
        <script type="text/javascript" src="src/timespan-boundary.js"></script>
        <script type="text/javascript" src="src/teleperiod.js"></script>
        <script type="text/javascript" src="src/timeline.js"></script>
        <script type="text/javascript" src="src/selection.js"></script>
    </head>

    <body>

        <header class="navbar navbar-static-top bs-docs-nav" id="top" role="banner">
          <div class="container">
            <div class="navbar-header">
              <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a href="/" class="navbar-brand">Teleperiod</a>
            </div>

          </div>
        </header>

        <div class="container bs-docs-container">

            <div class="row">
                <svg id="teleperiod_placeholder"></svg>
            </div>

            <form class="col-md-6">
                <h3>Selection</h3>
                <div class="form-group">
                    <label for="dtstart">Start date</label>
                    <input type="text" class="form-control" id="dtstart" />
                </div>
                <div class="form-group">
                    <label for="dtend">End date</label>
                    <input type="text" class="form-control" id="dtend" />
                </div>

                <button type="submit" class="btn btn-default">Submit</button>
            </form>

            <div class="col-md-6">
                <h3>Details</h3>

                <p>Duration: <span class="duration"></span></p>

                <div class="details"></div>
            </div>
        </div>


        <script type="text/javascript">

            var teleperiod = new teleperiod({
                object: d3.select('#teleperiod_placeholder'),
                workingtimes: function(interval) {

                    // return working times (selectable periods)

                    var workingtimes = [];
                    var loop = new Date(interval.from);
                    while (loop.getTime() < interval.to.getTime()) {

                        if (loop.getDay() != 0 && loop.getDay() != 6) {

                            var am = {};
                            var pm = {};

                            am.dtstart = new Date(loop);
                            am.dtstart.setHours(9, 0, 0);

                            am.dtend = new Date(loop);
                            am.dtend.setHours(12, 0, 0);

                            pm.dtstart = new Date(loop);
                            pm.dtstart.setHours(13, 0, 0);

                            pm.dtend = new Date(loop);
                            pm.dtend.setHours(18, 0, 0);

                            workingtimes.push(am);
                            workingtimes.push(pm);
                        }

                        loop.setDate(loop.getDate() + 1);
                    }

                    return workingtimes;
                },

                events: function(interval) {

                    // return other events displayed on the graph

                    var events = [];

                    var loop = new Date(interval.from);

                    while (loop.getTime() < interval.to.getTime()) {
                        if (0 === loop.getMonth() && 1 === loop.getDate()) {

                            var newYearDay = {
                                summary: 'New year day'
                            };

                            newYearDay.dtstart = new Date(loop);
                            newYearDay.dtstart.setHours(0, 0, 0);

                            newYearDay.dtend = new Date(newYearDay.dtstart);
                            newYearDay.dtend.setDate(newYearDay.dtstart.getDate() + 1);
                            events.push(newYearDay);
                        }


                        loop.setDate(loop.getDate() + 1);
                    }


                    events.push({
                        summary: 'Test',
                        dtstart: new Date(2015, 1, 3, 9, 30, 0),
                        dtend: new Date(2015, 1, 7, 17, 15, 0)
                    });


                    return events;
                },

                onUpdated: function(selection) {

                    var dtstart = selection.dtstart ? selection.dtstart.toLocaleString() : null;
                    var dtend = selection.dtend ? selection.dtend.toLocaleString() : null;

                    d3.select('#dtstart').attr('value', dtstart);
                    d3.select('#dtend').attr('value', dtend);

                    d3.select('.duration').text(selection.getDuration()+' ms');
                    var details = d3.select('.details');
                    details.selectAll("p").remove();

                    var arr = selection.getValidPeriods();
                    for(var i=0; i< arr.length; i++) {
                        details.append('p').text('From '+arr[i].dtstart.toLocaleString()+ ' to '+arr[i].dtend.toLocaleString());
                    }
                }
            });



            var vacations = new timeline('Scolar vacations', function(interval) {

                var events = [];
                var christmas = {
                    summary: 'Christmas vacations',
                    dtstart: new Date(2014, 11, 20, 19, 0, 0),
                    dtend: new Date(2015, 0, 5, 8, 0, 0)
                }

                if (interval.from < christmas.dtend && interval.to > christmas.dtstart) {
                    events.push(christmas);
                }

                return events;
            });

            teleperiod.addTimeLine(vacations);


            teleperiod.setSize();
            teleperiod.createMain();
        </script>
    </body>
</html>
